<!-- BotÃ³n flotante para abrir el chat -->
<button
  class="chatbot-boton"
  pButton
  icon="pi pi-comments"
  (click)="mostrarChat = true"
  label="IA">
</button>

<!-- Popup del chat -->
<div class="chatbot-popup" *ngIf="mostrarChat">
  <!-- Header -->
  <div class="chatbot-header">
    <span>ðŸ¤– Chat con la IA</span>

    <div class="acciones">
      <button
        class="chatbot-new"
        type="button"
        (click)="nuevaConversacion()"
        [disabled]="cargando">
        Nueva conversaciÃ³n
      </button>

      <button
        class="chatbot-close"
        type="button"
        (click)="mostrarChat = false"
        aria-label="Minimizar">âˆ’</button>
    </div>
  </div>

  <!-- Caja principal -->
  <div class="chat-box">
    <!-- Mensajes -->
    <div class="mensajes">
      <div *ngFor="let mensaje of historialMensajes">
        <div
          [ngClass]="mensaje.origen === 'yo' ? 'mensaje-yo' : 'mensaje-ia'"
          [innerHTML]="mensaje.texto | markdownHtml">
        </div>
      </div>

      <!-- Indicador de escritura opcional -->
      <div *ngIf="cargando" class="mensaje-ia">
        <em>La IA estÃ¡ escribiendoâ€¦</em>
      </div>
    </div>

    <!-- Input + Enviar -->
    <div class="chat-input">
      <input
        type="text"
        [(ngModel)]="mensajeUsuario"
        (keyup.enter)="enviarMensaje()"
        placeholder="EscribÃ­ tu mensaje..."
        class="p-inputtext"
        [disabled]="cargando" />

      <button
        pButton
        icon="pi pi-send"
        class="p-button-sm p-button-rounded"
        (click)="enviarMensaje()"
        [disabled]="!mensajeUsuario.trim() || cargando">
      </button>
    </div>
  </div>
</div>
