<div class="usuarios-container">
  <div class="usuarios-header">
    <h2>üë§ Lista de Usuarios</h2>

    <!-- Solo lo ve ADMIN o SUPERADMIN y solo si no est√° creando -->
    <div *ngIf="puedeCrear && !creando" class="crear-usuario-wrapper">
      <button class="crear-usuario-btn" (click)="abrirFormularioCrearUsuario()">
        ‚ûï Crear usuario
      </button>
    </div>
  </div>

  <!-- ‚úÖ Formulario para crear usuario -->
  <div #formularioCrear *ngIf="creando" class="formulario-crear-usuario">
    <h3>Crear nuevo usuario</h3>

    <form [formGroup]="formulario" (ngSubmit)="crearUsuario()">
      <!-- NOMBRE -->
      <label>
        Nombre:
        <input type="text" formControlName="nombre" />
      </label>
      <div *ngIf="formulario.get('nombre')?.invalid && formulario.get('nombre')?.touched">
        <small style="color: red;" *ngIf="formulario.get('nombre')?.errors?.['required']">El nombre es obligatorio</small>
        <small style="color: red;" *ngIf="formulario.get('nombre')?.errors?.['minlength']">M√≠nimo 2 caracteres</small>
        <small style="color: red;" *ngIf="formulario.get('nombre')?.errors?.['maxlength']">M√°ximo 50 caracteres</small>
        <small style="color: red;" *ngIf="formulario.get('nombre')?.errors?.['pattern']">Solo letras y espacios</small>
      </div>

      <!-- EMAIL -->
      <label>
        Email:
        <input type="email" formControlName="email" />
      </label>
      <div *ngIf="formulario.get('email')?.invalid && formulario.get('email')?.touched">
        <small style="color: red;">Debe ingresar un email v√°lido</small>
      </div>

      <!-- ROL -->
      <label>
        Rol:
        <select formControlName="rol">
          <option value="" disabled>Seleccione un rol</option>
          <option *ngFor="let rol of rolesDisponibles" [value]="rol">{{ rol }}</option>
        </select>
      </label>
      <div *ngIf="formulario.get('rol')?.invalid && formulario.get('rol')?.touched">
        <small style="color: red;">Debe seleccionar un rol</small>
      </div>

      <!-- ACTIVO -->
      <label>
        <input type="checkbox" formControlName="activo" />
        Usuario activo
      </label>

      <!-- BOTONES -->
      <div style="margin-top: 1rem;">
        <button type="submit">‚úÖ Crear usuario</button>
        <button type="button" (click)="cancelarCreacion()">‚ùå Cancelar</button>
      </div>
    </form>
  </div>

  <!-- ‚úÖ Tabla de usuarios -->
  <table class="usuarios-tabla">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Correo electr√≥nico</th>
        <th>Rol</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let usuario of usuarios">
        <td><i class="fa-solid fa-user"></i> {{ usuario.nombre }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.rol }}</td>
        <td>
          <button (click)="editarRol(usuario)">Editar</button>
          <button (click)="eliminarUsuario(usuario.id)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- BOT√ìN CERRAR SESI√ìN -->
  <button class="logout-btn" (click)="cerrarSesion()">Cerrar sesi√≥n</button>
</div>
