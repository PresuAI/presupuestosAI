<!-- Toast -->
<div
  class="toast"
  [class.toast--success]="toastKind === 'success'"
  [class.toast--error]="toastKind === 'error'"
  [class.toast--info]="toastKind === 'info'"
  *ngIf="toastMsg"
>
  {{ toastMsg }}
</div>

<div class="page">
  <div class="usuarios-container">
    <div class="usuarios-header">
      <h2><span class="icon"></span> Lista de Usuarios</h2>

      <button
        class="btn btn-primary"
        *ngIf="canCreate && !creando"
        (click)="abrirCrear()"
      >
        Ôºã Crear usuario
      </button>
    </div>

    <!-- Form crear / editar rol -->
    <div class="usuario-form-centrado" *ngIf="creando">
      <div class="form-card">
        <h3>{{ editando ? "Cambiar rol" : "Crear nuevo usuario" }}</h3>

        <form [formGroup]="form" (ngSubmit)="guardar()" class="form">
          <label for="nombre">Nombre:</label>
          <input
            id="nombre"
            type="text"
            formControlName="nombre"
            [readonly]="editando"
          />

          <label for="email">Email:</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            [readonly]="editando"
          />

          <ng-container *ngIf="!editando">
            <label for="password">Contrase√±a (m√≠n. 6)</label>
            <input id="password" type="password" formControlName="password" />
          </ng-container>

          <label for="rol">Rol:</label>
          <select id="rol" formControlName="rol">
            <option value="">Seleccione un rol</option>
            <option *ngFor="let r of rolesDisponibles" [value]="r">
              {{ r }}
            </option>
          </select>

          <!-- Checkbox alineado y consistente -->
          <div class="activo-row">
            <input type="checkbox" formControlName="activo" />
            <label>Usuario activo</label>
          </div>

          <!-- Acciones -->
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button type="button" class="btn btn-secondary" (click)="cancelar()">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Tabla -->
    <div class="tabla-usuarios" *ngIf="!creando">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Correo electr√≥nico</th>
              <th>Rol</th>
              <th class="col-acciones">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of usuarios">
              <td><span class="u-ico"></span> {{ u.nombre }}</td>
              <td class="email-cell">{{ u.email }}</td>
              <td>
                <span
                  class="chip"
                  [class.chip--sa]="u.rol === 'SUPERADMIN'"
                  [class.chip--ad]="u.rol === 'ADMIN'"
                  [class.chip--us]="u.rol === 'USUARIO'"
                >
                  {{ u.rol }}
                </span>
              </td>
              <td class="acciones">
                <button
                  class="icon-btn edit"
                  title="Cambiar rol"
                  (click)="abrirEditarRol(u)"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="icon-btn del"
                  title="Eliminar"
                  (click)="pedirEliminar(u)"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <app-chatbot></app-chatbot>
  </div>
</div>

<!-- Confirmaci√≥n de borrado -->
<div *ngIf="confirmVisible" class="sbx-confirm">
  <div class="sbx-overlay" (click)="cerrarConfirm()"></div>

  <div
    class="sbx-card"
    role="dialog"
    aria-modal="true"
    aria-labelledby="sbx-title"
  >
    <div class="sbx-head">
      <span class="sbx-trash">üóëÔ∏è</span>
      <h4 id="sbx-title">Eliminar Usuario</h4>
    </div>

    <p class="sbx-question">
      ¬øSeguro que quer√©s borrar
      <strong>‚Äú{{ usuarioAEliminar?.nombre }}‚Äù</strong>?
    </p>
    <p class="sbx-hint">Esta acci√≥n no se puede deshacer.</p>

    <div class="sbx-actions">
      <button type="button" class="sbx-btn cancel" (click)="cerrarConfirm()">
        Cancelar
      </button>
      <button
        type="button"
        class="sbx-btn danger"
        (click)="confirmarEliminar()"
      >
        S√≠, borrar
      </button>
    </div>
  </div>
</div>
